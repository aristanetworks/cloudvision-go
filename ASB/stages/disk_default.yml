---
- block:
   - name: "Copy disk setup script to /root"
     copy:
         src: "{{STAGES_PATH}}/disk_conf/SetupAroraDisk.build+user"
         dest: /root

   - name: "Partition and format disks"
     shell: "python /root/{{DISK_CMD}}"
  rescue:
   - name: "Some error occurred, retrying ASB from beginning."
     include: "{{STAGES_PATH}}/reimage_conf/retry.yml"

   - fail: msg="Disk install was unsuccessful - retrying"

# Make resync rate high to get the MD array resync done before OS install.
# The rates are reset back to the normal values during config stage.
- name: "Increase maximum disk resync rate."
  shell: "echo 1000000 > /proc/sys/dev/raid/speed_limit_max"
  ignore_errors: true

- name: "Increase minimum disk resync rate."
  shell: "echo 50000 > /proc/sys/dev/raid/speed_limit_min"
  ignore_errors: true

- name: "Update datacenter.servers with status that disk setup has finished"
  command: "{{ASB_DB_UPDATE_RESYNC_RUNNING}}"
...

