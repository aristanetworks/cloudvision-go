---
- name: "Perform PXE installation checks"
  include: "{{STAGES_PATH}}/cleanup_conf/qworker_pxeks_checks.yml"

# When PXE KS install check fails, it's not a transient error
# or an error that can be corrected by retrying.
- name: "PXE install checks failed. Need manual intervention"
  command: "{{ASB_DB_UPDATE_HELP}}"
  when: not PXE_KS_INSTALL_STATUS

- fail: msg="Aborting the install"
  when: not PXE_KS_INSTALL_STATUS

- name: "Re-enable monitoring on this machine."
  command: "{{ASB_DB_RESET_DISABLEMONITORING}}"

# This assures that there is at least a SMART test scheduled to run
# so that we can use the results when needed, especially since
# this server has been installed anew. It also helps to check
# health of the server right after new installation.
- name: "Trigger long SMART selftests for each disk."
  shell: "smartctl -t long /dev/{{ item }}"
  with_items: "{{ ansible_devices.keys() }}"

- name: "Update datacenter.servers - machine is installed"
  command: "{{ASB_DB_UPDATE_INSTALLED}}"
...
