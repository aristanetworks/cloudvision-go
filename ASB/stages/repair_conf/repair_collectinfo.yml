---
- name: "Collect SMART data on each disk"
  set_fact:
      disks: "{{ansible_devices.keys()}}"

- name: "Collect SMART records for each disk for given repair status"
  shell: "smartctl -a /dev/{{item}} >> /root/SMART_{{STATUS}}_{{ansible_hostname}}_{{item}}"
  with_items: "{{disks}}"
  ignore_errors: yes

- name: "Send each SMART data to Ansible VM"
  shell: " export HISTCONTROL=ignorespace && sshpass -p arastra scp -o StrictHostKeyChecking=no /root/SMART_{{STATUS}}* root@ansible:/var/log/ASBTrigger/repair-hosts/"
  ignore_errors: yes

- name: "Clean up SMART files"
  shell: "rm /root/SMART_{{STATUS}}*"
...
